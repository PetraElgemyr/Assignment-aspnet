@model ProjectsViewModel
@{
    var selectedUsersJson = "[]";
}
@* 




<section id="addProjectModal" class="modal">
    <div class="card">
        <div class="card-header">
            <h3>Add Project</h3>
            <button data-type="close" data-target="#addProjectModal" type="button" class="btn-close"></button>
        </div>
        <div class="card-body">
            <form asp-controller="Projects" asp-action="Add" method="post" id="projectForm" novalidate data-name="project" enctype="multipart/form-data">
              
                <div class="form-group">
                    <div class="image-preview-container">
                        <div id="image-container" class="circle circle-gray">
                            <i class="fa-duotone fa-solid fa-camera" style="--fa-primary-color: #bdbdbd; --fa-secondary-color: #ffffff; --fa-secondary-opacity: 1;"></i>
                        </div>


                    </div>
                    <img id="image-preview" src="" class="hide"/>

                </div>

                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input class="form-input" type="text" />
                </div>

                <div class="form-group">
                    <label class="form-label">Client Name</label>
                    <div class="form-select" data-placeholder="Select a client">
                        <button type="button" class="form-select-trigger">
                            <span class="form-select-text"></span>
                        </button>
                        <ul class="form-select-options">
                            <li class="form-select-option">Client 1</li>
                            <li class="form-select-option">Client 2</li>
                        </ul>
                        <input type="hidden" name="client-select-value" />
                    </div>
                </div>


                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="hide"></textarea>

                </div>

                <div class="form-horizontal-group">
                    <div class="form-group">
                        <label class="form-label">Start Date</label>
                        <input class="form-input" type="date" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">End Date</label>
                        <input class="form-input" type="date" />
                    </div>

                </div>


                <div class="form-group">
                    <label class="form-label">Members</label>
                    <div class="form-select" data-placeholder="Select a member">
                        <button type="button" class="form-select-trigger">
                            <span class="form-select-text"></span>
                        </button>
                        <ul class="form-select-options">
                            <li class="form-select-option">Hans Mattin-Lassei</li>
                            <li class="form-select-option">Tommy Mattin-Lassei</li>
                        </ul>
                        <input type="hidden" name="member-select-value" />
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Budget</label>
                    <div class="form-input-extended">
                        <i class="fa-duotone fa-solid fa-dollar-sign"></i>
                        <input class="form-input" type="text" />

                    </div>
                </div>

                <button type="submit" class="btn">Create</button>
            </form>

        </div>
    </div>

</section>

*@

<div id="addProjectModal" class="modal">
    <div class="modal-content">
        <header class="modal-header">
            <h3>Add Project</h3>
            <button data-type="close" data-target="#addProjectModal" type="button" class="btn-close"></button>
        </header>
        <div class="modal-body">
            <form id="projectForm" novalidate method="post" data-name="project" asp-action="Add" asp-controller="Projects" enctype="multipart/form-data">
                <div class="form-group">
                    <div class="image-preview-container">
                        <div id="image-container" class="circle circle-gray">
                            <i class="fa-duotone fa-solid fa-camera" style="--fa-primary-color: #bdbdbd; --fa-secondary-color: #ffffff; --fa-secondary-opacity: 1;"></i>
                        </div>


                    </div>
                    <img id="image-preview" src="" class="hide" />

                </div>

                <div class="form-group">
                    <label asp-for="AddProjectViewModel.ProjectName"></label>
                    <div class="field-group">
                        <input asp-for="AddProjectViewModel.ProjectName" />
                        <span asp-validation-for="AddProjectViewModel.ProjectName"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="AddProjectViewModel.ClientId"></label>
                    <select asp-for="AddProjectViewModel.ClientId" asp-items="Model.Clients"></select>
                </div>


                <div class="form-group">
                    <label asp-for="AddProjectViewModel.Description"></label>
                    <div class="wysiwyg-container">
                        <textarea asp-for="AddProjectViewModel.Description" class="hide"></textarea>
                        <div id="add-project-description-editor" class="wysiwyg-editor"></div>
                        <div id="add-project-description-toolbar" class="wysiwyg-toolbar">
                            <span class="ql-formats">
                                <button class="ql-bold"></button>
                                <button class="ql-italic"></button>
                                <button class="ql-underline"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-align" value=""></button>
                                <button class="ql-align" value="center"></button>
                                <button class="ql-align" value="right"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-list" value="bullet"></button>
                                <button class="ql-list" value="ordered"></button>
                            </span>
                            <span class="ql-formats">
                                <button class="ql-link"></button>
                            </span>
                        </div>
                    </div>
                </div>

                <div class="form-group date-group">
                    <div class="form-group-date">
                        <label asp-for="AddProjectViewModel.StartDate"></label>
                        <div class="field-group">
                            <input asp-for="AddProjectViewModel.StartDate" />
                            <span asp-validation-for="AddProjectViewModel.StartDate"></span>
                        </div>
                    </div>

                    <div class="form-group-date">
                        <label asp-for="AddProjectViewModel.EndDate"></label>
                        <div class="field-group">
                            <input asp-for="AddProjectViewModel.EndDate"  />
                            <span asp-validation-for="AddProjectViewModel.EndDate"></span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="AddProjectViewModel.Budget"></label>
                    <div class="field-group">
                        <input asp-for="AddProjectViewModel.Budget"/>
                        <span asp-validation-for="AddProjectViewModel.Budget"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label asp-for="AddProjectViewModel.UserIds">Members</label>
                    <input type="hidden" asp-for="AddProjectViewModel.UserIds" />

                    <div id="tagged-users" class="form-input form-user-select">
                        <input type="text" id="user-search" class="form-user-input" placeholder="Add member(s)..." />
                        <label for="user-search" class="fa-solid fa-ellipsis"></label>
                        <div id="user-search-results" class="search-results"></div>
                    </div>
                </div>

                <button type="submit" class="btn btn-blue btn-submit">Create</button>

            </form>
        </div>

    </div>
</div>




<script>

    const preSelectedUsers = @Html.Raw(selectedUsersJson);
    initWysiwygEditor('#add-project-description-editor',
    '#add-project-description-toolbar',
    '#AddProjectViewModel_Description',
    '@Html.Raw(Model.AddProjectViewModel.Description ?? "")')

    initTagSelector({
        containerId: 'tagged-users',
        inputId: 'user-search',
        resultsId: 'user-search-results',
        searchUrl: (query) => '@Url.Action("SearchUsers", "Projects")' + '?term=' + encodeURIComponent(query), // TODO kom ihåg ändra till p-controller
        displayProperty: 'fullName',
        // imageProperty: 'imageUrl',
        imageProperty: '@Model.AddProjectViewModel.Image',
        tagClass: 'user-tag',
        avatarFolder: '/images/profiles/',
        emptyMessage: 'No members found.',
        preSelected: preSelectedUsers,
        selectedInputIds: 'AddProjectViewModel_UserIds' // TODO kom ihåg nytt id
    })
</script>